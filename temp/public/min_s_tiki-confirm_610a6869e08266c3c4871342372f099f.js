function confirmSimple(event,title,ticket){return confirmPopup(event,!1,title,ticket)}
function confirmAjax(event){return confirmPopup(event,!0)}
function confirmPopup(event,ajax,title,ticket){if(!event){return!1}
$('div.popover').hide();if(checkTimeout()){event.preventDefault();if(ajax){var target=$('.modal.fade:not(.show)').first(),formAction=$(event.currentTarget).attr('formaction')||$(event.currentTarget.form).attr('action');$.post(formAction,$(event.currentTarget.form).serialize(),function(data){$('.modal-content',target).html(data);target.modal().trigger('tiki.modal.redraw')});return!1}else{if(event.currentTarget.form){var optionConfirm=$(event.currentTarget.form).find('select > option.confirm-simple'),selected=$(event.currentTarget.form).find('select > option.confirm-simple:selected');if(!optionConfirm.length||selected.length){var formId=$(event.currentTarget.form).attr('id')?$(event.currentTarget.form).attr('id')+'-confirm-simple':'confirm-simple',formName=$(event.currentTarget.form).attr('name')?$(event.currentTarget.form).attr('name')+'-confirm-simple':'confirm-simple',newForm=$('<form/>',{name:formName,id:formId,action:$(event.currentTarget.form).attr('action'),method:'post'}),inputs=$(event.currentTarget.form).find('input, textarea, select > option:selected');$.each(inputs,function(){if(this.type!=='submit'&&(this.type!=='checkbox'||this.checked===!0)&&(this.type!=='radio'||this.checked===!0)){var name=this.tagName==='OPTION'?$(this).parent('select').attr('name'):this.name;newForm.append($('<input />',{type:'hidden',name:name,value:this.value}))}});if(event.currentTarget.name){newForm.append($('<input />',{type:'hidden',name:event.currentTarget.name,value:event.currentTarget.value}))}
if(selected.length){$.each(selected,function(key,item){if($(selected[key]).data('confirm-text')){title=$(selected[key]).data('confirm-text');return!1}})}
simpleConfirmForm(event.currentTarget,newForm,title,ticket).modal()}else{$(event.currentTarget.form).submit()}}else if(event.currentTarget.tagName==='A'){var newForm=$('<form/>',{id:'confirm-simple',action:event.currentTarget.pathname,method:'post'}),params=event.currentTarget.search.substr(1).split('&');if(params){for(var i=0;i<params.length;i++){var parampair=params[i].split("=")
newForm.append($('<input />',{type:'hidden',name:decodeURIComponent(parampair[0]),value:decodeURIComponent(parampair[1])}))}}
simpleConfirmForm(event.currentTarget,newForm,title,ticket).modal()}}}}
function simpleConfirmForm(clickedElement,newForm,title,ticket){if(!title){title=$(clickedElement).data('confirm-text')?$(clickedElement).data('confirm-text'):tr('Complete this action?')}
if(!ticket&&!$(newForm).find('input[name=ticket]').length&&$(clickedElement).data('ticket')){ticket=$(clickedElement).data('ticket')}
if(!$(newForm).find('input[name=ticket]').length&&ticket){newForm.append($('<input />',{type:'hidden',name:'ticket',value:ticket}))}
newForm.append($('<input />',{type:'hidden',name:'confirmForm',value:'y'}));var target=$('.modal.fade:not(.in)').first();$('.modal-content',target).html('<div class="modal-header">'+'<h4 class="modal-title" id="myModalLabel">'+title+'</h4>'+$(newForm).prop('outerHTML')+'</div>'+'<div class="modal-footer">'+'<button type="button" class="btn btn-primary btn-dismiss" data-dismiss="modal">'+tr('Close')+'</button>'+'<input type="submit" class="btn btn-primary" value="'+tr('OK')+'" onclick="$(\'#'+$(newForm).attr('id')+'\').submit(); return false;"> '+'</div>');return target}
function postForm(event){event.preventDefault();var formAction=$(event.currentTarget).attr('formaction')||$(event.currentTarget.form).attr('action');$.post(formAction,$(event.currentTarget.form).serialize(),function(data){});return!1}
$('form').has('input[name=ticket]').on('mousedown keydown','select',function(){checkElement(this)}).on('mousedown keydown','input',function(){checkElement(this)}).on('mousedown keydown','textarea',function(){checkElement(this)});function checkElement(element){if($(element).hasClass('already-warned')){return!0}else{if(!checkTimeout()){$(element).addClass('already-warned')}
return!0}}
function checkTimeout(){if((($.now()-now.getTime())/1000)<jqueryTiki.securityTimeout){return!0}else{event.preventDefault();feedback([tr('The security ticket for this form has expired.')+' '+tr('To apply your changes, note or copy them, reload the page, re-enter them and retry submitting.')],'warning',!0,tr('Security ticket timed out'));var target=$('.modal.fade:not(.show)').first();$('.modal-body',target).after('<div class="modal-footer">'+'<a href="#" onclick="$.closeModal();return false;" class="btn btn-primary">'+tr('Close this dialog')+'</a>'+'<a href="'+location.href+'" onclick="location.reload();return false;" class="btn btn-secondary">'+tr('Reload now (discards changes)')+'</a>'+'</div>');return!1}}
function confirmAction(event){event.preventDefault();if(typeof event.currentTarget!=='undefined'&&event.currentTarget.form!=='undefined'){var targetForm=event.currentTarget.form}else if(typeof event.target!=='undefined'&&event.target.form!=='undefined'){var targetForm=event.target.form}
$.ajax({dataType:'json',url:$(targetForm).attr('action'),type:'POST',data:$(targetForm).serialize(),success:function(data){if(!data){$.closeModal();return}
var extra=data.extra||!1,dataurl=data.url||!1,dataError=data.error||!1,strip=data.strip||!1;if(extra){if(extra==='close'){$.closeModal()}else if(extra==='refresh'){$.closeModal();if(strip){if(strip==='anchor'||strip==='queryAndAnchor'){var href=document.location.href.replace(/#.*$/,"");document.location.href=document.location.href.replace(/#.*$/,"");if(strip==='queryAndAnchor'){document.location.href=document.location.href.replace(/\?.*$/,"")}}}else{document.location.href=document.location.href}}}
if(dataurl){$.closeModal();document.location.assign(dataurl)}
if(dataError){if(dataError==='CSRF'){dataError=tr('Potential cross-site request forgery (CSRF) detected. Operation blocked. The security ticket may have expired - reloading the page may help.')}
$.closeModal();feedback(dataError,'error');console.log(dataError)}
return!1}})}